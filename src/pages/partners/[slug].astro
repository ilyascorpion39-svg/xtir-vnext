---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { partners, type Partner } from '@/data/partners';
import { SITE, withBase } from '@/site';

export async function getStaticPaths() {
  // Добавляйте партнёров в src/data/partners.ts
  // Пример-заглушка (example-partner) не генерируется.
  const items = partners.filter((p) => p.slug !== 'example-partner');
  return items.map((p) => ({ params: { slug: p.slug }, props: { partner: p } }));
}

const { partner } = Astro.props as { partner: Partner };
const title = `${partner.name} — партнёр XTIR`;
const logo = withBase(partner.logoSrc || '/images/products/placeholder.svg');
---

<BaseLayout title={title} description={partner.tagline}>
  <main class="pt-12 pb-20">
    <section class="max-w-7xl mx-auto px-6">
      <div class="flex items-center gap-4">
        <a
          class="text-sm text-gray-400 hover:text-gray-200 transition"
          href={withBase("/partners/")}
        >
          ← Все партнёры
        </a>
      </div>

      <div class="mt-6 grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-8">
        <aside class="rounded-2xl border border-white/10 bg-white/5 p-6">
          <div class="flex items-center gap-4">
            <img
              src={logo}
              alt={partner.name}
              class="h-16 w-16 rounded-xl bg-black/40 object-contain p-2"
              loading="lazy"
              decoding="async"
              width="64"
              height="64"
            />
            <div>
              <h1 class="text-2xl font-semibold text-white leading-tight">{partner.name}</h1>
              <p class="mt-1 text-sm text-gray-300">{partner.tagline}</p>
            </div>
          </div>

          <div class="mt-6 space-y-2">
            {partner.websiteUrl ? (
              <a
                class="inline-flex w-full items-center justify-center rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm text-white hover:bg-white/10 transition"
                href={partner.websiteUrl}
                target="_blank"
                rel="noreferrer"
              >
                Перейти на сайт
              </a>
            ) : null}

            <a
              class="inline-flex w-full items-center justify-center rounded-xl border border-white/10 bg-black/20 px-4 py-2 text-sm text-white hover:bg-black/30 transition"
              href={withBase("/contact/")}
            >
              Связаться с нами
            </a>
          </div>

          {partner.location ? (
            <div class="mt-6">
              <div class="text-xs uppercase tracking-wider text-gray-500">География</div>
              <div class="mt-1 text-sm text-gray-200">{partner.location}</div>
            </div>
          ) : null}

          {partner.links?.length ? (
            <div class="mt-6">
              <div class="text-xs uppercase tracking-wider text-gray-500">Ссылки</div>
              <ul class="mt-2 space-y-2">
                {partner.links.map((l) => (
                  <li>
                    <a
                      class="text-sm text-gray-200 hover:text-white transition"
                      href={l.url}
                      target="_blank"
                      rel="noreferrer"
                    >
                      {l.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ) : null}

          <div class="mt-6">
            <div class="text-xs uppercase tracking-wider text-gray-500">Каналы XTIR</div>
            <div class="mt-3 grid grid-cols-2 gap-2">
              {SITE.telegramChannelUrl ? (
                <a class="inline-flex items-center justify-center rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white hover:bg-white/10 transition" href={SITE.telegramChannelUrl} target="_blank" rel="noreferrer">Telegram</a>
              ) : null}
              {SITE.vkChannelUrl ? (
                <a class="inline-flex items-center justify-center rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white hover:bg-white/10 transition" href={SITE.vkChannelUrl} target="_blank" rel="noreferrer">VK</a>
              ) : null}
              {SITE.youtubeChannelUrl ? (
                <a class="inline-flex items-center justify-center rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white hover:bg-white/10 transition" href={SITE.youtubeChannelUrl} target="_blank" rel="noreferrer">YouTube</a>
              ) : null}
              {SITE.rutubeChannelUrl ? (
                <a class="inline-flex items-center justify-center rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-sm text-white hover:bg-white/10 transition" href={SITE.rutubeChannelUrl} target="_blank" rel="noreferrer">RuTube</a>
              ) : null}
            </div>
          </div>
        </aside>

        <article class="rounded-2xl border border-white/10 bg-white/5 p-6 md:p-8">
          <h2 class="text-xl font-semibold text-white">О партнёре</h2>
          <div class="mt-4 space-y-4 text-gray-200 leading-relaxed">
            {partner.description.split('\n').map((p) => (
              <p>{p}</p>
            ))}
          </div>

          <div class="mt-10 rounded-2xl border border-white/10 bg-black/20 p-6">
            <h3 class="text-lg font-semibold text-white">Материалы и интеграции</h3>
            <p class="mt-2 text-sm text-gray-300">
              По просьбе партнёров мы размещаем их информацию на сайте. Если нужно добавить файл, описание, фото,
              ссылку на видео или каталог — напишите нам, и мы подключим всё в эту страницу.
            </p>
            <div class="mt-4">
              <a class="btn-secondary" href={withBase("/docs/")}>Открыть документацию</a>
            </div>
          </div>
        </article>
      </div>
    </section>
  </main>

</BaseLayout>
