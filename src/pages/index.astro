---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Hero from "@/components/sections/Hero.astro";
import TacticalProductGrid from "@/components/sections/TacticalProductGrid.astro";
import { withBase } from "@/site";
import { PRODUCTS, PRODUCT_CATEGORIES } from "@/data/products";

const categoryCounts = PRODUCT_CATEGORIES.map((category) => ({
  ...category,
  total: PRODUCTS.filter((product) => product.categoryId === category.id)
    .length,
}))
  .filter((category) => category.total > 0)
  .sort((a, b) => b.total - a.total);

const battleMetrics = [
  { value: `${PRODUCTS.length}+`, label: "позиций каталога" },
  { value: `${categoryCounts.length}`, label: "категорий решений" },
  { value: "24/7", label: "техподдержка" },
  { value: "1 день", label: "срок первичного ответа" },
];

const quickScenarioCards = [
  {
    preset: "Ведомственный тир",
    title: "Ведомственный тир",
    text: "Подбираем конфигурацию под учебные задачи, регламент эксплуатации и текущую инфраструктуру объекта.",
  },
  {
    preset: "Полигонный комплекс",
    title: "Полигонный комплекс",
    text: "Комбинируем мишенное оборудование, динамику и управление в единую управляемую систему.",
  },
  {
    preset: "Модернизация существующего тира",
    title: "Модернизация",
    text: "Интегрируем новые модули в существующий объект без потери совместимости и управляемости.",
  },
];

const executionSteps = [
  {
    step: "Шаг 01",
    title: "Получаем вводные",
    text: "Задачи стрельб, режим эксплуатации, ограничения по объекту и бюджету.",
  },
  {
    step: "Шаг 02",
    title: "Собираем конфигурацию",
    text: "Формируем набор установок и логику управления под конкретный сценарий.",
  },
  {
    step: "Шаг 03",
    title: "Согласуем и запускаем",
    text: "Фиксируем состав, сроки, объем работ и переходим к производству/поставке.",
  },
  {
    step: "Шаг 04",
    title: "Сопровождаем после внедрения",
    text: "Поддержка, диагностика, обновления и расширение системы под новые задачи.",
  },
];
---

<BaseLayout
  title="XTIR — Точная техника. Жёсткая надёжность."
  description="XTIR — разработка и производство электронно-механического оборудования для стрельбы."
>
  <Hero />
  <TacticalProductGrid />

  <section class="hp-sec hp-battle home-section cv-auto">
    <div class="hp-wrap home-container" data-reveal>
      <div class="hp-hd hp-battle-hd" data-reveal="2">
        <div class="hp-kicker">Режим запуска</div>
        <h2 class="hp-title">Соберем решение под ваш объект за 60 секунд</h2>
        <div class="hp-sub">
          Не уводим в длинные диалоги: фиксируем вводные и сразу переходим к
          рабочей конфигурации с понятным составом оборудования.
        </div>
      </div>

      <div class="hp-battle-metrics" data-reveal="2">
        {
          battleMetrics.map((metric) => (
            <div class="hp-bm">
              <strong>{metric.value}</strong>
              <span>{metric.label}</span>
            </div>
          ))
        }
      </div>

      <div class="hp-battle-grid">
        {
          quickScenarioCards.map((card, idx) => (
            <article
              class="hp-bcard home-card home-card--hover"
              data-reveal={String(idx + 2)}
            >
              <div class="hp-bcard-step">
                {String(idx + 1).padStart(2, "0")}
              </div>
              <h3>{card.title}</h3>
              <p>{card.text}</p>
              <a
                href={withBase(
                  `/contact/?preset=${encodeURIComponent(card.preset)}`,
                )}
                class="hp-lnk"
              >
                Отправить вводные →
              </a>
            </article>
          ))
        }
      </div>

      <div class="hp-battle-steps" data-reveal="5">
        {
          executionSteps.map((item) => (
            <article class="hp-bstep home-card">
              <div class="hp-bstep-num">{item.step}</div>
              <h3>{item.title}</h3>
              <p>{item.text}</p>
            </article>
          ))
        }
      </div>
    </div>
  </section>

  <div class="hp-flow">
    <!-- ПОЧЕМУ XTIR -->
    <section class="hp-sec hp-darker home-section cv-auto">
      <div class="hp-wrap hp-why home-container" data-reveal>
        <div class="hp-wl" data-reveal="2">
          <div class="hp-kicker">Почему XTIR</div>
          <h2 class="hp-title">
            Инженерный подход.<br />Предсказуемый результат.
          </h2>
          <div class="hp-sub">
            20 лет в отрасли. Оборудование, которое реально работает не на
            презентации, а на объекте.
          </div>
          <a href={withBase("/about/")} class="hp-lnk">О компании →</a>
        </div>
        <div class="hp-wr">
          <div class="hp-wc home-card home-card--hover" data-reveal="2">
            <span class="hp-wi hp-wi--design" aria-hidden="true"></span><div
              class="hp-wt"
            >
              Проектирование
            </div><div class="hp-wd">
              Требования, расчёт, прототипирование, документация. Без догадок.
            </div>
          </div>
          <div class="hp-wc home-card home-card--hover" data-reveal="3">
            <span class="hp-wi hp-wi--factory" aria-hidden="true"></span><div
              class="hp-wt"
            >
              Производство
            </div><div class="hp-wd">
              Сборка, контроль, повторяемость. Узлы рассчитаны на реальную
              эксплуатацию.
            </div>
          </div>
          <div class="hp-wc home-card home-card--hover" data-reveal="4">
            <span class="hp-wi hp-wi--link" aria-hidden="true"></span><div
              class="hp-wt"
            >
              Интеграции
            </div><div class="hp-wd">
              Связь, управление, сценарии. Подстраиваемся под объект и задачи
              заказчика.
            </div>
          </div>
          <div class="hp-wc home-card home-card--hover" data-reveal="5">
            <span class="hp-wi hp-wi--support" aria-hidden="true"></span><div
              class="hp-wt"
            >
              Поддержка
            </div><div class="hp-wd">
              Сопровождение, диагностика, обновления. 24/7.
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section
      class="hp-sec hp-dark home-section cv-auto"
      style="position:relative;overflow:hidden;"
    >
      <div class="hp-wrap hp-cta home-container" data-reveal>
        <div class="hp-ctl" data-reveal="2">
          <h2 class="hp-title">Готовы начать?</h2>
          <div class="hp-sub">Опишите задачу — ответим быстро и по делу.</div>
          <div class="hp-acts" style="margin-top:28px;">
            <a href={withBase("/contact/")} class="home-btn home-btn--primary"
              >Обсудить проект</a
            >
            <a
              href={withBase("/products/")}
              class="home-btn home-btn--secondary">Каталог →</a
            >
          </div>
        </div>
        <div class="hp-ctr" data-reveal="3">
          <a href="tel:+79154250095" class="hp-cnt"
            ><span class="hp-cl">Телефон</span><span class="hp-cv"
              >+7 (915) 425-00-95</span
            ></a
          >
          <a href="tel:+79162962469" class="hp-cnt"
            ><span class="hp-cl">Доп. телефон</span><span class="hp-cv"
              >+7 (916) 296-24-69</span
            ></a
          >
          <a href="mailto:info@xtir.ru" class="hp-cnt"
            ><span class="hp-cl">Email</span><span class="hp-cv"
              >info@xtir.ru</span
            ></a
          >
        </div>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  /* ── ОБЩИЕ ── */
  .hp-flow {
    position: relative;
    overflow: clip;
    background:
      radial-gradient(
        740px 360px at 50% 50%,
        rgba(82, 154, 255, 0.1),
        rgba(82, 154, 255, 0) 72%
      ),
      radial-gradient(
        520px 240px at 84% 20%,
        rgba(86, 109, 220, 0.07),
        rgba(86, 109, 220, 0) 74%
      ),
      linear-gradient(180deg, #070d16 0%, #050a12 100%);
  }
  .hp-flow::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background-image:
      linear-gradient(rgba(120, 176, 255, 0.035) 1px, transparent 1px),
      linear-gradient(90deg, rgba(120, 176, 255, 0.03) 1px, transparent 1px);
    background-size: 58px 58px;
    mask-image: linear-gradient(
      180deg,
      transparent 0%,
      black 18%,
      black 85%,
      transparent 100%
    );
    opacity: 0.42;
  }
  .hp-flow :global(.home-section + .home-section::before) {
    display: none;
  }
  .hp-sec {
    padding-block: clamp(44px, 6vw, 72px);
  }
  .hp-dark {
    background: transparent;
  }
  .hp-darker {
    background: transparent;
    border-top: 0;
    border-bottom: 0;
  }
  .hp-wrap {
    width: min(var(--home-container), calc(100% - (var(--home-gutter) * 2)));
    margin: 0 auto;
  }
  .hp-hd {
    margin-bottom: 30px;
  }
  .hp-kicker {
    font-family: "Courier New", monospace !important;
    font-size: 0.68rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: #00b3ff;
    opacity: 0.75;
    margin-bottom: 10px;
  }

  /* Перебиваем Tailwind заголовки */
  .hp-title {
    font-size: var(--home-h2) !important;
    font-weight: 800 !important;
    line-height: 1.08 !important;
    letter-spacing: -0.02em !important;
    color: #ffffff !important;
    margin: 0 0 14px !important;
    font-family: inherit !important;
    text-transform: none !important;
  }
  .hp-sub {
    font-size: var(--home-body) !important;
    line-height: 1.65 !important;
    color: var(--home-body-muted) !important;
    margin: 0 !important;
    font-family: inherit !important;
    font-weight: normal !important;
    text-transform: none !important;
    max-width: 60ch;
  }
  .hp-acts {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .hp-lnk {
    display: inline-block;
    margin-top: 16px;
    color: #00b3ff !important;
    text-decoration: none !important;
    font-weight: 600;
    transition: opacity 0.2s;
  }
  .hp-lnk:hover {
    opacity: 0.7;
  }

  /* Быстрый запуск */
  .hp-battle {
    padding-top: clamp(44px, 7vw, 70px);
    padding-bottom: clamp(44px, 7vw, 74px);
    background:
      radial-gradient(
        560px 320px at 14% 30%,
        rgba(0, 179, 255, 0.12),
        transparent 72%
      ),
      radial-gradient(
        680px 380px at 88% 66%,
        rgba(95, 135, 255, 0.1),
        transparent 74%
      ),
      linear-gradient(180deg, #07101a 0%, #060e18 100%);
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }
  .hp-battle-hd {
    margin-bottom: 24px;
  }
  .hp-battle-metrics {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 12px;
    margin-bottom: 16px;
  }
  .hp-bm {
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 14px;
    padding: 12px 14px;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.04),
      rgba(255, 255, 255, 0.015)
    );
  }
  .hp-bm strong {
    display: block;
    font-size: 1.18rem;
    color: #fff;
    line-height: 1.1;
    margin-bottom: 4px;
  }
  .hp-bm span {
    font-family: "Courier New", monospace;
    font-size: 0.62rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(172, 216, 255, 0.84);
  }
  .hp-battle-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 12px;
    margin-bottom: 12px;
  }
  .hp-bcard {
    padding: 16px;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.04),
      rgba(255, 255, 255, 0.016)
    );
  }
  .hp-bcard-step {
    font-family: "Courier New", monospace;
    font-size: 0.63rem;
    letter-spacing: 0.16em;
    color: rgba(127, 208, 255, 0.9);
    margin-bottom: 8px;
  }
  .hp-bcard h3 {
    margin: 0 0 6px;
    font-size: 1rem;
    color: #fff;
    line-height: 1.3;
  }
  .hp-bcard p {
    margin: 0;
    color: rgba(255, 255, 255, 0.72);
    font-size: 0.86rem;
    line-height: 1.56;
  }
  .hp-bcard .hp-lnk {
    margin-top: 12px;
  }
  .hp-battle-steps {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 10px;
  }
  .hp-bstep {
    padding: 12px;
    background: rgba(255, 255, 255, 0.015);
  }
  .hp-bstep-num {
    font-family: "Courier New", monospace;
    font-size: 0.6rem;
    letter-spacing: 0.13em;
    text-transform: uppercase;
    color: rgba(173, 219, 255, 0.78);
    margin-bottom: 7px;
  }
  .hp-bstep h3 {
    margin: 0 0 5px;
    font-size: 0.86rem;
    color: #fff;
  }
  .hp-bstep p {
    margin: 0;
    font-size: 0.77rem;
    line-height: 1.5;
    color: rgba(255, 255, 255, 0.68);
  }

  /* Почему XTIR */
  .hp-why {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: start;
  }
  @media (max-width: 900px) {
    .hp-why {
      grid-template-columns: 1fr;
      gap: 40px;
    }
  }
  .hp-wr {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  .hp-wc {
    padding: 22px;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.035),
      rgba(255, 255, 255, 0.012)
    );
  }
  .hp-wi {
    width: 28px;
    height: 28px;
    border-radius: 8px;
    border: 1px solid rgba(138, 201, 255, 0.42);
    background: linear-gradient(
      180deg,
      rgba(103, 164, 223, 0.2),
      rgba(103, 164, 223, 0.04)
    );
    margin-bottom: 10px;
    position: relative;
  }
  .hp-wi::before,
  .hp-wi::after {
    content: "";
    position: absolute;
  }
  .hp-wi--design::before {
    width: 14px;
    height: 2px;
    background: rgba(186, 225, 255, 0.9);
    top: 8px;
    left: 6px;
    box-shadow: 0 6px 0 rgba(150, 206, 255, 0.7);
  }
  .hp-wi--factory::before {
    inset: 8px 7px 7px;
    border: 1px solid rgba(174, 222, 255, 0.84);
    border-top: 0;
  }
  .hp-wi--factory::after {
    left: 7px;
    right: 7px;
    top: 7px;
    height: 2px;
    background: rgba(174, 222, 255, 0.84);
  }
  .hp-wi--link::before,
  .hp-wi--link::after {
    width: 8px;
    height: 8px;
    border: 1px solid rgba(182, 226, 255, 0.9);
    border-radius: 99px;
    top: 9px;
  }
  .hp-wi--link::before {
    left: 5px;
  }
  .hp-wi--link::after {
    right: 5px;
  }
  .hp-wi--support::before {
    inset: 7px;
    border: 1px solid rgba(186, 228, 255, 0.9);
    border-radius: 99px;
  }
  .hp-wi--support::after {
    width: 8px;
    height: 8px;
    border-radius: 99px;
    background: rgba(173, 222, 255, 0.9);
    left: 9px;
    top: 9px;
  }
  .hp-wt {
    font-size: 0.9rem !important;
    font-weight: 700 !important;
    color: #fff !important;
    margin-bottom: 7px;
    font-family: inherit !important;
    text-transform: none !important;
  }
  .hp-wd {
    font-size: 0.83rem !important;
    color: rgba(255, 255, 255, 0.45) !important;
    line-height: 1.6;
    font-family: inherit !important;
    font-weight: normal !important;
  }

  /* CTA */
  .hp-cta {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 42px;
    align-items: center;
    position: relative;
  }
  @media (max-width: 768px) {
    .hp-cta {
      grid-template-columns: 1fr;
      gap: 36px;
    }
  }
  .hp-ctr {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .hp-cnt {
    display: flex;
    flex-direction: column;
    gap: 3px;
    text-decoration: none !important;
    transition: opacity 0.2s;
    padding: 10px 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.02);
  }
  .hp-cnt:hover {
    opacity: 0.7;
  }
  .hp-cl {
    font-family: "Courier New", monospace !important;
    font-size: 0.62rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: rgba(255, 255, 255, 0.4);
  }
  .hp-cv {
    font-size: 1.08rem !important;
    font-weight: 700 !important;
    color: #fff !important;
    font-family: inherit !important;
  }

  @media (max-width: 900px) {
    .hp-hd {
      margin-bottom: 28px;
    }
    .hp-battle-metrics {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .hp-battle-grid {
      grid-template-columns: 1fr;
    }
    .hp-battle-steps {
      grid-template-columns: 1fr;
    }
    .hp-wr {
      grid-template-columns: 1fr;
    }
    .hp-sec {
      padding-block: clamp(38px, 9vw, 58px);
    }
    .hp-cnt {
      padding: 10px 0;
    }
  }
</style>
