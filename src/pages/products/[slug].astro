---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { PRODUCTS, getProductBySlug } from '@/data/products';
import { SITE } from '@/site';

export function getStaticPaths() {
  return PRODUCTS.map((product) => ({
    params: { slug: product.slug },
  }));
}

const { slug } = Astro.params;
const product = getProductBySlug(slug);

if (!product) {
  return Astro.redirect('/products');
}
---

<BaseLayout
  title={product.name}
  description={product.description.slice(0, 160)}
>
  <main class="min-h-screen px-4 py-10">
    <div class="mx-auto max-w-6xl">
      <div class="grid gap-10 lg:grid-cols-2">
        <div>
          {product.photos.length > 0 ? (
            <div class="rounded-2xl border border-white/10 bg-gradient-to-br from-white/5 to-transparent p-6">
              <img
                src={product.photos[0]}
                alt={product.name}
                class="w-full rounded-2xl border border-white/10 bg-white/5 object-contain"
                loading="eager"
              />
            </div>
          ) : (
            <div class="flex aspect-[4/3] w-full items-center justify-center rounded-2xl border border-white/10 bg-white/5 text-white/50">
              Фото скоро появятся
            </div>
          )}

          {product.photos.length > 1 && (
            <div class="mt-4 flex gap-3 overflow-x-auto pb-2">
              {product.photos.slice(1).map((photo, index) => (
                <img
                  src={photo}
                  alt={`${product.name} превью ${index + 2}`}
                  class="h-20 w-28 shrink-0 rounded-lg border border-white/10 bg-white/5 object-cover"
                  loading="lazy"
                />
              ))}
            </div>
          )}
        </div>

        <div class="space-y-5">
          <h1 class="text-4xl font-semibold text-white">{product.name}</h1>
          <p class="text-sm text-white/60">{product.category}</p>
          <p class="text-base leading-7 text-white/80">{product.description.slice(0, 220) + "…"}</p>
          <a
            href="/contact"
            class="inline-flex items-center rounded-xl border border-white/20 px-5 py-3 text-sm font-medium text-white hover:bg-white/10"
          >
            Оставить заявку
          </a>
        </div>
      </div>

      <section class="mt-16">
        <h2 class="text-2xl font-semibold text-white mb-6">
          Ключевые особенности
        </h2>

        <div class="grid sm:grid-cols-2 gap-6 text-white/80">
          <div>• Надёжная конструкция промышленного уровня</div>
          <div>• Электромеханический привод с амортизацией</div>
          <div>• Подходит для интенсивной эксплуатации</div>
          <div>• Интеграция в существующие стрелковые комплексы</div>
        </div>
      </section>

      {product.specs && product.specs.length > 0 && (
        <section class="mt-16">
          <h2 class="text-2xl font-semibold text-white mb-6">
            Технические характеристики
          </h2>

          <div class="rounded-2xl border border-white/10 overflow-hidden">
            <div class="divide-y divide-white/10">
              {product.specs.map((spec) => (
                <div class="grid grid-cols-2 items-center px-6 py-3 text-sm">
                  <div class="text-white/70 font-medium">
                    {spec.label}
                  </div>
                  <div class="text-white font-medium">
                    {spec.value}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>
      )}

      <section class="mt-20">
        <h2 class="text-2xl font-semibold text-white">Описание</h2>
        <p class="mt-4 text-base leading-7 text-white/80">{product.description}</p>
      </section>

      <section class="mt-20">
        <div class="rounded-2xl border border-white/10 bg-gradient-to-r from-white/5 to-transparent p-10">
          <h3 class="text-xl font-semibold text-white mb-4">
            Нужна консультация по {product.name}?
          </h3>

          <p class="text-white/70 mb-6">
            Подберём конфигурацию под вашу задачу и условия эксплуатации.
          </p>

          <a
            href={`mailto:${SITE.contactEmail}`}
            class="inline-flex items-center px-6 py-3 rounded-lg bg-primary-500 hover:bg-primary-400 text-black font-medium transition"
          >
            Связаться с нами
          </a>
        </div>
      </section>
    </div>
  </main>
</BaseLayout>
