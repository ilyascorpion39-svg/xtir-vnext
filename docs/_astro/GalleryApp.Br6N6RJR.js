import{j as e}from"./jsx-runtime.D3GSbgeI.js";import{r as d}from"./index.yGrMsBkE.js";import"./index.yBjzXJbu.js";function p(l){if(!Number.isFinite(l)||l<=0)return"";const o=l/1024;if(o<1024)return`${o.toFixed(0)} КБ`;const n=o/1024;return n<1024?`${n.toFixed(1)} МБ`:`${(n/1024).toFixed(2)} ГБ`}function b(l){switch(l){case"image":return"Фото";case"pdf":return"PDF";case"video":return"Видео";case"audio":return"Аудио";case"doc":return"Документ";default:return"Файл"}}function k(l){try{return encodeURIComponent(l)}catch{return l}}function z({items:l}){const[o,n]=d.useState(null),[x,g]=d.useState(""),[m,v]=d.useState("all"),[w,u]=d.useState(null),f=d.useMemo(()=>{const t=new Map;for(const i of l||[])t.set(i.id,i);return t},[l]),y=d.useMemo(()=>{const t=new Map;for(const i of l||[]){const r=i.folder||"Прочее",a=t.get(r)||{name:r,count:0,cover:void 0};a.count+=1,!a.cover&&i.type==="image"&&(a.cover=i.url),t.set(r,a)}return Array.from(t.values()).sort((i,r)=>r.count-i.count)},[l]),j=d.useMemo(()=>{let t=l||[];if(o&&(t=t.filter(r=>(r.folder||"Прочее")===o)),m!=="all"&&(t=t.filter(r=>r.type===m)),x.trim()){const r=x.trim().toLowerCase();t=t.filter(a=>`${a.title} ${a.relPath} ${a.folder}`.toLowerCase().includes(r))}const i={image:0,pdf:1,doc:2,video:3,audio:4,other:5};return[...t].sort((r,a)=>{const c=i[r.type]??99,h=i[a.type]??99;return c!==h?c-h:r.title.localeCompare(a.title,"ru")})},[l,o,x,m]),s=w?f.get(w):void 0;d.useEffect(()=>{const t=()=>{const r=(window.location.hash||"").match(/asset=([^&]+)/i);if(!r)return;const a=r[1];let c=a;try{c=decodeURIComponent(a)}catch{c=a}const h=f.get(c);h&&(n(h.folder||"Прочее"),u(h.id))};return t(),window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)},[f]);const N=(l||[]).length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-5",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:"Галерея"}),e.jsx("div",{className:"text-sm text-gray-300",children:"Фото установок XTIR и материалы партнёров — аккуратно разложены карточками."})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{value:x,onChange:t=>g(t.target.value),placeholder:"Поиск по названиям и папкам…",className:"w-full sm:w-[360px] rounded-xl border border-white/10 bg-black/30 px-4 py-2.5 text-sm text-gray-100 placeholder:text-gray-500 outline-none focus:border-[#93ff5a]/40"})}),e.jsxs("select",{value:m,onChange:t=>v(t.target.value),className:"w-full sm:w-auto rounded-xl border border-white/10 bg-black/30 px-3 py-2.5 text-sm text-gray-100 outline-none focus:border-[#93ff5a]/40",children:[e.jsx("option",{value:"all",children:"Все типы"}),e.jsx("option",{value:"image",children:"Фото"}),e.jsx("option",{value:"pdf",children:"PDF"}),e.jsx("option",{value:"doc",children:"Документы"}),e.jsx("option",{value:"video",children:"Видео"}),e.jsx("option",{value:"audio",children:"Аудио"}),e.jsx("option",{value:"other",children:"Прочее"})]})]})]})}),!o&&e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[y.map(t=>e.jsxs("button",{type:"button",onClick:()=>n(t.name),className:"group relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 text-left transition hover:border-[#93ff5a]/30 hover:bg-white/10",children:[e.jsx("div",{className:"absolute inset-0",children:t.cover?e.jsx("img",{src:t.cover,alt:t.name,className:"h-full w-full object-cover opacity-30 blur-[1px] transition group-hover:opacity-40",loading:"lazy"}):e.jsx("div",{className:"h-full w-full bg-[radial-gradient(circle_at_20%_20%,rgba(147,255,90,.18),transparent_55%),radial-gradient(circle_at_80%_30%,rgba(60,220,255,.10),transparent_55%)]"})}),e.jsxs("div",{className:"relative p-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-white",children:t.name}),e.jsxs("div",{className:"mt-1 text-sm text-gray-300",children:[t.count," файлов"]})]}),e.jsx("span",{className:"rounded-full border border-white/10 bg-black/40 px-3 py-1 text-xs text-gray-200",children:"Открыть"})]}),e.jsx("div",{className:"mt-4 text-xs text-gray-400",children:"Карточки с названиями и описанием — удобно для просмотра."})]})]},t.name)),!N&&e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 p-6 text-sm text-gray-300",children:["Пока нет материалов для галереи.",e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Как только добавим фото и документы — здесь появятся карточки с названиями и описанием."})]})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:o}),e.jsxs("div",{className:"text-sm text-gray-300",children:[j.length," файлов",x.trim()?" по вашему поиску":""]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{type:"button",onClick:()=>{n(null),g(""),v("all")},className:"rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm text-gray-100 hover:bg-white/10",children:"← Все разделы"})})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:j.map(t=>e.jsxs("button",{type:"button",onClick:()=>{u(t.id),window.location.hash=`asset=${k(t.id)}`},className:"group overflow-hidden rounded-2xl border border-white/10 bg-white/5 text-left transition hover:border-[#93ff5a]/30 hover:bg-white/10",children:[e.jsx("div",{className:"aspect-[4/3] w-full overflow-hidden bg-black/30",children:t.type==="image"?e.jsx("img",{src:t.url,alt:t.title,className:"h-full w-full object-cover transition group-hover:scale-[1.02]",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"rounded-xl border border-white/10 bg-black/40 px-4 py-2 text-sm text-gray-200",children:b(t.type)})})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"line-clamp-2 text-sm font-semibold text-white",children:t.title}),e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:[b(t.type),p(t.size)?` • ${p(t.size)}`:""]}),e.jsx("div",{className:"mt-2 line-clamp-1 text-[11px] text-gray-500",children:t.relPath})]})]},t.id))})]}),s&&e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70 p-4",onMouseDown:t=>{t.target===t.currentTarget&&(u(null),window.location.hash.startsWith("#asset=")&&(window.location.hash=""))},children:e.jsxs("div",{className:"w-full max-w-5xl overflow-hidden rounded-2xl border border-white/10 bg-[#0b0f14] shadow-2xl",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 border-b border-white/10 bg-black/30 px-5 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-white",children:s.title}),e.jsxs("div",{className:"mt-1 text-xs text-gray-400",children:[s.folder," • ",b(s.type),p(s.size)?` • ${p(s.size)}`:""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:s.url,className:"rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm text-gray-100 hover:bg-white/10",children:"Открыть файл"}),e.jsx("button",{type:"button",onClick:()=>{u(null),window.location.hash.startsWith("#asset=")&&(window.location.hash="")},className:"rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm text-gray-100 hover:bg-white/10",children:"Закрыть"})]})]}),e.jsxs("div",{className:"max-h-[75vh] overflow-auto p-4",children:[s.type==="image"&&e.jsx("img",{src:s.url,alt:s.title,className:"mx-auto max-h-[70vh] w-auto rounded-xl border border-white/10"}),s.type==="pdf"&&e.jsx("iframe",{title:s.title,src:s.url,className:"h-[70vh] w-full rounded-xl border border-white/10 bg-black/30"}),s.type!=="image"&&s.type!=="pdf"&&e.jsxs("div",{className:"rounded-xl border border-white/10 bg-black/30 p-5 text-sm text-gray-200",children:["Этот тип файла лучше открыть напрямую:"," ",e.jsx("a",{className:"text-[#93ff5a] hover:underline",href:s.url,children:"нажмите сюда"}),"."]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["Обновлено: ",s.updatedAt]})]})]})})]})}export{z as default};
